<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RIVER LOG - Pagination Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        .box { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 15px; }
        input { background: #0f172a; border: 1px solid #475569; border-radius: 8px; padding: 12px; color: white; width: 100%; outline: none; font-size: 16px; }
        .brand-gradient { background: linear-gradient(135deg, #60a5fa 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .priority-row { background: rgba(99, 102, 241, 0.15); border-left: 4px solid #6366f1; }
        .tab-active { background: #4f46e5 !important; color: white !important; font-weight: 900; box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.4); }
        button:active { transform: scale(0.94); transition: 0.1s; }
        .dev-glow { background: linear-gradient(45deg, #6366f1, #a855f7); box-shadow: 0 0 12px rgba(147, 51, 234, 0.6); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .page-btn { background: #334155; color: #94a3b8; padding: 8px 14px; border-radius: 8px; font-weight: bold; font-size: 13px; transition: 0.2s; }
        .page-btn.active { background: #4f46e5; color: white; }
    </style>
</head>
<body class="pb-10">

    <nav class="sticky top-0 z-50 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 p-3">
        <div class="max-w-2xl mx-auto flex flex-col md:flex-row justify-between items-center gap-3">
            <div class="flex items-center gap-3 w-full md:w-auto justify-between md:justify-start">
                <span class="font-black brand-gradient italic tracking-tighter text-xl">RIVER LOG</span>
                <a href="https://x.com/thejediworld77" target="_blank" class="dev-glow px-4 py-2 rounded-xl flex flex-col items-center transition-transform hover:scale-105">
                    <span class="text-[8px] font-bold text-indigo-100 uppercase tracking-widest">Developer</span>
                    <span class="text-[11px] font-black text-white">@ê¹€ì§€í˜¸bwd</span>
                </a>
            </div>
            
            <div class="flex items-center gap-3 w-full md:w-auto justify-center md:justify-end">
                <select id="langSelect" onchange="changeLanguage(this.value)" class="bg-slate-800 border border-slate-700 text-[10px] text-white rounded-lg px-2 py-1.5 outline-none">
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option><option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option><option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option><option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
                </select>
                <div id="clockDisplay" class="flex gap-2 overflow-x-auto no-scrollbar"></div>
            </div>
        </div>
    </nav>

    <div class="max-w-2xl mx-auto p-4">
        <div class="box mb-6 border-2 border-indigo-500/40 bg-indigo-900/10 shadow-xl">
            <div class="flex gap-2 mb-2">
                <input id="managerId" type="text" placeholder="ì›í•˜ëŠ” IDë¥¼ ì •í•´ì„œ ì…ë ¥í•˜ì„¸ìš”" class="flex-1 border-indigo-500/50">
                <button onclick="saveAndConnect()" id="btnConnect" class="bg-indigo-600 px-6 rounded-lg font-black text-sm">ì ‘ì†</button>
            </div>
            <p id="txt-id-info" class="text-[11px] text-slate-400">ì›í•˜ëŠ” IDë¥¼ ì •í•œ í›„ ì´ì›ƒë“¤ì„ ë“±ë¡í•´ì£¼ì„¸ìš”. ë“±ë¡í•œ ì´ì›ƒë“¤ì„ ë³¼ ë•Œë„ ì •í•œ IDë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <div class="flex justify-between gap-1 mb-6 bg-slate-800/50 p-1 rounded-xl no-scrollbar overflow-x-auto">
            <button onclick="switchCountry('KR')" id="tab-KR" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 font-black">KR</button>
            <button onclick="switchCountry('US')" id="tab-US" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 font-black">US</button>
            <button onclick="switchCountry('CN')" id="tab-CN" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 font-black">CN</button>
            <button onclick="switchCountry('JP')" id="tab-JP" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 font-black">JP</button>
            <button onclick="switchCountry('VN')" id="tab-VN" class="flex-1 min-w-[65px] py-3 text-xs rounded-lg text-slate-400 font-black">VN</button>
        </div>

        <div class="box mb-8 shadow-xl border border-indigo-500/10">
            <div class="grid grid-cols-1 gap-3 mb-4">
                <input id="userName" type="text" placeholder="ë‹‰ë„¤ì„ (Nickname)">
                <input id="userXId" type="text" placeholder="X ID (@ì•„ì´ë””)">
                <input id="passCode" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" class="border-indigo-500/20">
            </div>
            <button onclick="saveUser()" id="btnSubmit" class="w-full bg-indigo-600 py-4 rounded-xl font-black text-white shadow-lg uppercase">ë“±ë¡í•˜ê¸°</button>
        </div>

        <div class="box p-0 overflow-hidden border-slate-800 shadow-2xl mb-4">
            <table class="w-full text-left">
                <tbody id="userTableBody" class="text-sm divide-y divide-slate-800"></tbody>
            </table>
        </div>

        <div id="pagination" class="flex justify-center gap-2 mt-6 mb-10"></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://xheuxdsbwcueutukeblm.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_TW6tF_10D5-zv5FdXZE87g_8sNPZmuF'; 
        const PRIVATE_CODE = '2126';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let currentCountry = 'KR';
        let currentLang = 'ko';
        let allUsers = []; // ì „ì²´ ë°ì´í„°ë¥¼ ë‹´ëŠ” ë³€ìˆ˜
        let currentPage = 1;
        const itemsPerPage = 10; // í˜ì´ì§€ë‹¹ 10ëª… [í˜ì´ì§• ê¸°ëŠ¥ í•µì‹¬]

        const timeZones = { KR: 'Asia/Seoul', US: 'America/New_York', CN: 'Asia/Shanghai', JP: 'Asia/Tokyo', VN: 'Asia/Ho_Chi_Minh' };

        const translations = {
            ko: { idPlace: "ì›í•˜ëŠ” IDë¥¼ ì •í•´ì„œ ì…ë ¥í•˜ì„¸ìš”", connect: "ì ‘ì†", idInfo: "ì›í•˜ëŠ” IDë¥¼ ì •í•œ í›„ ì´ì›ƒë“¤ì„ ë“±ë¡í•´ì£¼ì„¸ìš”. ë“±ë¡í•œ ì´ì›ƒë“¤ì„ ë³¼ ë•Œë„ ì •í•œ IDë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", submit: "ë“±ë¡í•˜ê¸°", namePlace: "ë‹‰ë„¤ì„ (Nickname)", xPlace: "X ID (@ì•„ì´ë””)", passPlace: "ë¹„ë°€ë²ˆí˜¸ ì…ë ¥", edit: "ìˆ˜ì •", del: "ì‚­ì œ", up: "ìœ„ë¡œ", down: "ì•„ë˜ë¡œ", prev: "ì´ì „", next: "ë‹¤ìŒ" },
            en: { idPlace: "Enter Private ID", connect: "Connect", idInfo: "Set your ID first, then register neighbors.", submit: "SUBMIT", namePlace: "Nickname", xPlace: "X ID", passPlace: "Enter Password", edit: "Edit", del: "Delete", up: "Up", down: "Down", prev: "Prev", next: "Next" }
        };

        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang] || translations.en;
            document.getElementById('managerId').placeholder = t.idPlace;
            document.getElementById('btnConnect').innerText = t.connect;
            document.getElementById('txt-id-info').innerText = t.idInfo;
            document.getElementById('userName').placeholder = t.namePlace;
            document.getElementById('userXId').placeholder = t.xPlace;
            document.getElementById('passCode').placeholder = t.passPlace;
            document.getElementById('btnSubmit').innerText = t.submit;
            renderTable(allUsers);
        }

        window.onload = () => {
            const savedId = localStorage.getItem('river_manager_id');
            if(savedId) { document.getElementById('managerId').value = savedId; fetchUsers(); }
            setInterval(updateLiveClocks, 1000);
            updateLiveClocks();
        };

        function saveAndConnect() {
            const mId = document.getElementById('managerId').value;
            if(!mId) return;
            localStorage.setItem('river_manager_id', mId);
            currentPage = 1; // ID ë³€ê²½ ì‹œ 1í˜ì´ì§€ë¡œ ë¦¬ì…‹
            fetchUsers();
            alert(`[${mId}] ì ‘ì† ì„±ê³µ!`);
        }

        async function fetchUsers() {
            const mId = document.getElementById('managerId').value;
            if(!mId) return;
            const { data } = await supabaseClient.from('river_members').select('*').eq('country', currentCountry).eq('manager_id', mId).order('priority', { ascending: false }).order('id', { ascending: false });
            allUsers = data || [];
            renderTable(allUsers);
        }

        // ğŸ“ í…Œì´ë¸” ë Œë”ë§ (10ëª…ì”© ëŠì–´ì„œ ë³´ì—¬ì£¼ê¸°)
        function renderTable(users) {
            const tableBody = document.getElementById('userTableBody');
            tableBody.innerHTML = '';
            const t = translations[currentLang] || translations.en;

            // í˜ì´ì§• ê³„ì‚° ë¡œì§
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pagedUsers = users.slice(startIndex, endIndex);

            pagedUsers.forEach((user, index) => {
                const isHigh = user.priority > 0;
                const row = document.createElement('tr');
                row.className = isHigh ? "priority-row transition-colors" : "hover:bg-slate-800/30 transition-colors";
                
                // ë“±ë¡ ì‹œê°„ í‘œì‹œ ì‚­ì œë¨
                row.innerHTML = `<td class="p-4 w-full"><div class="flex justify-between items-start"><div class="flex-1"><div class="flex items-center gap-2 mb-1"><span class="text-[9px] font-bold ${isHigh ? 'text-indigo-400' : 'text-slate-500'}">${isHigh ? 'â­ TOP' : '#' + (startIndex + index + 1)}</span></div><a href="https://x.com/${user.x_id}" target="_blank" class="font-bold text-slate-100 text-base block mb-0.5 tracking-tight cursor-pointer">${user.name}</a><div class="text-[10px] text-slate-500 font-mono tracking-tighter">@${user.x_id}</div></div><div class="flex items-center gap-1">
                    <button onclick="adjustPriority(${user.id}, ${user.priority + 1})" title="${t.up}" class="bg-indigo-900/40 text-indigo-300 p-2 rounded-lg text-xs">ğŸ”¼</button>
                    <button onclick="adjustPriority(${user.id}, ${user.priority - 1})" title="${t.down}" class="bg-slate-800 text-slate-400 p-2 rounded-lg text-xs">ğŸ”½</button>
                    <button onclick="editName(${user.id}, '${user.name}')" title="${t.edit}" class="bg-slate-800 text-amber-400/80 p-2 rounded-lg text-xs ml-1">ğŸ“</button>
                    <button onclick="deleteUser(${user.id})" title="${t.del}" class="bg-red-900/10 text-red-500 p-2 rounded-lg text-xs ml-1">ğŸ—‘ï¸</button>
                </div></div></td>`;
                tableBody.appendChild(row);
            });

            renderPagination(users.length);
        }

        // ğŸ“Ÿ í˜ì´ì§€ ë²„íŠ¼ ìƒì„± í•¨ìˆ˜
        function renderPagination(totalCount) {
            const paginationDiv = document.getElementById('pagination');
            paginationDiv.innerHTML = '';
            const totalPages = Math.ceil(totalCount / itemsPerPage);
            const t = translations[currentLang] || translations.en;

            if (totalPages <= 1) return; // 10ëª… ì´í•˜ë©´ ë²„íŠ¼ ì•ˆ ë³´ì„

            // ì´ì „ ë²„íŠ¼
            const prevBtn = document.createElement('button');
            prevBtn.innerText = t.prev;
            prevBtn.className = `page-btn ${currentPage === 1 ? 'opacity-30' : ''}`;
            prevBtn.onclick = () => { if(currentPage > 1) { currentPage--; renderTable(allUsers); window.scrollTo(0,0); } };
            paginationDiv.appendChild(prevBtn);

            // ìˆ«ì ë²„íŠ¼
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.innerText = i;
                btn.className = `page-btn ${currentPage === i ? 'active' : ''}`;
                btn.onclick = () => { currentPage = i; renderTable(allUsers); window.scrollTo(0,0); };
                paginationDiv.appendChild(btn);
            }

            // ë‹¤ìŒ ë²„íŠ¼
            const nextBtn = document.createElement('button');
            nextBtn.innerText = t.next;
            nextBtn.className = `page-btn ${currentPage === totalPages ? 'opacity-30' : ''}`;
            nextBtn.onclick = () => { if(currentPage < totalPages) { currentPage++; renderTable(allUsers); window.scrollTo(0,0); } };
            paginationDiv.appendChild(nextBtn);
        }

        async function saveUser() {
            const mId = document.getElementById('managerId').value;
            const name = document.getElementById('userName').value;
            const xInput = document.getElementById('userXId').value;
            const pass = document.getElementById('passCode').value;
            if(!mId) { alert("ID ì ‘ì† í•„ìš”"); return; }
            if(pass !== PRIVATE_CODE) { alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜"); return; }
            let xId = xInput.trim().replace('@', '').split('x.com/').pop().split('?')[0];
            await supabaseClient.from('river_members').insert([{ name, x_id: xId, country: currentCountry, manager_id: mId, priority: 0 }]);
            document.getElementById('userName').value = ''; document.getElementById('userXId').value = ''; fetchUsers();
        }

        async function editName(id, oldName) {
            const newName = prompt(translations[currentLang].edit + ":", oldName);
            if(newName && newName !== oldName) { await supabaseClient.from('river_members').update({ name: newName }).eq('id', id); fetchUsers(); }
        }

        async function adjustPriority(id, newP) { await supabaseClient.from('river_members').update({ priority: newP }).eq('id', id); fetchUsers(); }

        async function deleteUser(id) { if(confirm(translations[currentLang].del + "?")) { await supabaseClient.from('river_members').delete().eq('id', id); fetchUsers(); } }

        function switchCountry(code) { currentCountry = code; currentPage = 1; document.querySelectorAll('[id^="tab-"]').forEach(btn => btn.classList.remove('tab-active')); document.getElementById(`tab-${code}`).classList.add('tab-active'); fetchUsers(); }

        function updateLiveClocks() {
            const html = Object.keys(timeZones).map(code => {
                const time = new Date().toLocaleTimeString('en-US', { timeZone: timeZones[code], hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
                return `<div class="flex flex-col items-center min-w-[52px] leading-tight"><span class="text-[8px] text-slate-500 font-bold">${code}</span><span class="text-[10px] text-blue-400 font-mono font-bold">${time}</span></div>`;
            }).join('');
            document.getElementById('clockDisplay').innerHTML = html;
        }
    </script>
</body>
</html>
