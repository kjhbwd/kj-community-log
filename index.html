<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>River ê¸€ë¡œë²Œ ìƒí˜¸ êµë¥˜ í™œì„±í™”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        .box { background: #1e293b; border: 1px solid #334155; border-radius: 12px; padding: 15px; }
        input { background: #0f172a !important; border: 1px solid #475569; border-radius: 8px; padding: 10px; color: white; outline: none; font-size: 14px; }
        .brand-gradient { background: linear-gradient(135deg, #60a5fa 0%, #c084fc 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* ğŸ·ï¸ íƒ€ì´í‹€: ë°˜ë“¯í•˜ê²Œ & ì˜ë¦¼ ë°©ì§€ */
        .nav-header { display: flex; justify-content: space-between; align-items: start; width: 100%; gap: 15px; }
        .title-area { flex: 1; text-align: center; padding-top: 10px; }
        .main-title-text { white-space: nowrap; font-weight: 900; display: inline-block; font-style: normal !important; letter-spacing: -0.02em; }
        
        /* â° ì‹œê³„ ì˜ì—­ í™•ëŒ€ */
        .clock-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; background: rgba(30, 41, 59, 0.5); padding: 8px; border-radius: 12px; border: 1px solid #334155; }
        .clock-item { display: flex; flex-direction: column; align-items: center; min-width: 50px; }
        .clock-label { font-size: 9px; font-weight: 900; color: #6366f1; }
        .clock-time { font-size: 12px; font-weight: 700; color: #60a5fa; font-family: 'monospace'; }

        /* ğŸ’° ìì‚° ìœ„ì ¯ */
        .asset-widget { background: rgba(30, 41, 59, 0.95); border: 1px solid rgba(99, 102, 241, 0.4); border-radius: 14px; padding: 8px 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        .tab-active { background: #4f46e5 !important; color: white !important; font-weight: 900; }
        .daily-log-box { background: rgba(15, 23, 42, 0.7); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; padding: 10px; margin-top: 8px; width: 100%; max-width: 320px; }
        .log-row { display: flex; justify-content: space-between; align-items: center; font-size: 11px; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .btn-icon { cursor: pointer; transition: opacity 0.2s; font-size: 14px; padding: 4px; }
        .member-link { color: #60a5fa; cursor: pointer; text-decoration: underline; text-underline-offset: 4px; font-weight: 700; }
        .member-link:hover { color: #c084fc; }
        .guide-box { font-size: 11px; color: #94a3b8; line-height: 1.6; border-left: 3px solid #6366f1; padding-left: 10px; }
        .page-btn { background: #334155; color: #94a3b8; padding: 4px 10px; border-radius: 6px; font-size: 12px; }
        .page-btn.active { background: #6366f1; color: white; font-weight: 900; }
    </style>
</head>
<body class="pb-10">

    <nav class="sticky top-0 z-50 bg-slate-900/95 backdrop-blur-md border-b border-slate-800 p-4">
        <div class="max-w-7xl mx-auto nav-header">
            <div id="clockDisplay" class="clock-grid"></div>
            
            <div class="title-area">
                <span id="main-title" class="main-title-text brand-gradient text-xl md:text-3xl">River ê¸€ë¡œë²Œ ìƒí˜¸ êµë¥˜ í™œì„±í™”</span>
            </div>
            
            <div class="flex flex-col items-end">
                <div class="asset-widget flex items-center gap-3">
                    <div class="flex flex-col items-center">
                        <span id="lbl-mypts" class="text-[7px] text-slate-500 font-black">MY PTS</span>
                        <input id="calcQty" type="number" oninput="runCalculation()" placeholder="0" class="w-14 text-center bg-transparent border-none text-white font-bold outline-none">
                    </div>
                    <div class="h-6 w-[1px] bg-slate-700"></div>
                    <div class="flex flex-col items-center">
                        <span id="lbl-ptsprice" class="text-[7px] text-indigo-400 font-black">PTS PRICE</span>
                        <span id="ptsPriceDisplay" class="text-[10px] font-black text-white">$ 0.000000</span>
                    </div>
                    <div class="h-6 w-[1px] bg-slate-700"></div>
                    <div class="flex flex-col items-end">
                        <span id="lbl-value" class="text-[7px] text-green-500 font-black">KRW VALUE</span>
                        <span id="resKrw" class="text-[12px] font-black text-white">â‚© 0</span>
                        <span id="currentUsdtRate" class="text-[8px] text-slate-500 font-mono">1 USDT = â‚© 0</span>
                    </div>
                </div>
                <div class="daily-log-box">
                    <div class="flex gap-2 mb-2">
                        <input id="dailyPtsInput" type="number" placeholder="ì˜¤ëŠ˜ ìˆ˜ëŸ‰" class="flex-1 bg-transparent border-b border-slate-600 text-[11px] p-1 text-white outline-none">
                        <button onclick="addDailyLogToDB()" id="btnLogAdd" class="bg-indigo-600 px-3 py-1 rounded text-[11px] font-black text-white">ê¸°ë¡</button>
                    </div>
                    <div id="dailyLogList" class="max-h-24 overflow-y-auto no-scrollbar"></div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-2xl mx-auto p-4 space-y-6">
        <div class="flex justify-end">
            <select id="langSelect" onchange="changeLanguage(this.value)" class="bg-slate-800 text-[11px] text-white rounded px-2 py-1 border border-slate-700 outline-none cursor-pointer">
                <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option><option value="en">ğŸ‡ºğŸ‡¸ English</option>
                <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option><option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option><option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
            </select>
        </div>

        <div class="box border-2 border-indigo-500/20 shadow-xl space-y-4">
            <div class="flex gap-2">
                <input id="managerId" type="text" placeholder="ID ì…ë ¥" class="flex-1 border-indigo-500/40">
                <button onclick="saveAndConnect()" id="btnConnect" class="bg-indigo-600 px-6 rounded-lg font-black text-sm text-white">ì ‘ì†</button>
            </div>
            <div id="guideContent" class="guide-box"></div>
        </div>

        <div class="box bg-slate-800/30 flex gap-2">
            <input id="newMemberName" type="text" class="flex-1">
            <input id="newMemberXId" type="text" class="flex-1">
            <button onclick="addNewMember()" id="btnAddMember" class="bg-blue-600 px-6 rounded-lg font-black text-xs text-white">ì¶”ê°€</button>
        </div>

        <div class="flex justify-between gap-1 bg-slate-800/50 p-1 rounded-xl overflow-x-auto no-scrollbar">
            <button onclick="switchCountry('KR')" id="tab-KR" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">KR</button>
            <button onclick="switchCountry('US')" id="tab-US" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">US</button>
            <button onclick="switchCountry('CN')" id="tab-CN" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">CN</button>
            <button onclick="switchCountry('JP')" id="tab-JP" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">JP</button>
            <button onclick="switchCountry('VN')" id="tab-VN" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">VN</button>
            <button onclick="switchCountry('TR')" id="tab-TR" class="flex-1 min-w-[55px] py-3 text-xs rounded-lg text-slate-400 font-black">TR</button>
        </div>

        <div class="box p-0 overflow-hidden border-slate-800 shadow-2xl">
            <table class="w-full text-left">
                <tbody id="userTableBody" class="text-sm divide-y divide-slate-800"></tbody>
            </table>
        </div>
        <div id="pagination" class="flex justify-center gap-2 pt-2"></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://xheuxdsbwcueutukeblm.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_TW6tF_10D5-zv5FdXZE87g_8sNPZmuF'; 
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const PRIVATE_CODE = '2126'; 
        
        let currentCountry = 'KR', currentLang = 'ko', allUsers = [], currentPage = 1;
        const itemsPerPage = 10;
        const timeZones = { KR: 'Asia/Seoul', US: 'America/New_York', CN: 'Asia/Shanghai', JP: 'Asia/Tokyo', VN: 'Asia/Ho_Chi_Minh', TR: 'Europe/Istanbul' };
        let livePtsPrice = 0, usdtKrwRate = 1485;

        const translations = {
            ko: { title: "River ê¸€ë¡œë²Œ ìƒí˜¸ êµë¥˜ í™œì„±í™”", connect: "ì ‘ì†", logBtn: "ê¸°ë¡", logPlace: "ì˜¤ëŠ˜ ìˆ˜ëŸ‰", mypts: "ë‚˜ì˜ PTS", ptsprice: "PTS PRICE", value: "KRW VALUE", xName: "X ë‹‰ë„¤ì„", xId: "X ì•„ì´ë”” (@ì•„ì´ë””)", addBtn: "ì¶”ê°€", guide: "<strong>ğŸ’¡ ì•ˆë‚´:</strong><br>1. <strong>ì ‘ì†</strong> ì‹œ ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br>2. <strong>ì´ë¦„ì„ í´ë¦­</strong>í•˜ë©´ X ê³„ì •ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.<br>3. ğŸ”¼/ğŸ”½ë¡œ ìˆœìœ„ë¥¼ <strong>í•œ ì¹¸ì”©</strong> ì¡°ì •í•˜ì„¸ìš”." },
            en: { title: "River Global Exchange Activation", connect: "Connect", logBtn: "Add", logPlace: "Daily Qty", mypts: "MY PTS", ptsprice: "PTS PRICE", value: "KRW VALUE", xName: "X Nickname", xId: "X ID (@username)", addBtn: "Add", guide: "<strong>ğŸ’¡ Info:</strong><br>1. Password required to <strong>Connect</strong>.<br>2. <strong>Click name</strong> to visit X profile.<br>3. Use ğŸ”¼/ğŸ”½ to adjust rank <strong>one by one</strong>." },
            tr: { title: "River KÃ¼resel DeÄŸiÅŸim Aktivasyonu", connect: "BaÄŸlan", logBtn: "Ekle", logPlace: "GÃ¼nlÃ¼k Adet", mypts: "PTS'LERÄ°M", ptsprice: "PTS FÄ°YATI", value: "KRW DEÄERÄ°", xName: "X Takma AdÄ±", xId: "X KimliÄŸi (@kullanÄ±cÄ±)", addBtn: "Ekle", guide: "<strong>ğŸ’¡ Bilgi:</strong><br>1. YÃ¶netim iÃ§in <strong>BaÄŸlan</strong> ÅŸifresi gerekir.<br>2. X'e gitmek iÃ§in <strong>isme tÄ±klayÄ±n</strong>.<br>3. ğŸ”¼/ğŸ”½ ile <strong>tek tek</strong> sÄ±ralayÄ±n." },
            zh: { title: "River å…¨çƒç›¸äº’äº¤æµæ¿€æ´»", connect: "è¿æ¥", logBtn: "æäº¤", logPlace: "ä»Šæ—¥æ•°é‡", mypts: "æˆ‘çš„ PTS", ptsprice: "PTS ä»·æ ¼", value: "KRW ä»·å€¼", xName: "X æ˜µç§°", xId: "X ID (@ID)", addBtn: "æ·»åŠ ", guide: "<strong>ğŸ’¡ æŒ‡å—:</strong><br>1. <strong>è¿æ¥</strong> éœ€å¯†ç ã€‚<br>2. <strong>ç‚¹å‡»åå­—</strong> è·³è½¬ Xã€‚<br>3. ä½¿ç”¨ ğŸ”¼/ğŸ”½ <strong>é€çº§</strong> è°ƒæ•´ã€‚" },
            ja: { title: "River ã‚°ãƒ­ãƒ¼ãƒãƒ«ç›¸äº’äº¤æµã®æ´»æ€§åŒ–", connect: "æ¥ç¶š", logBtn: "ç™»éŒ²", logPlace: "ä»Šæ—¥ã®æ•°é‡", mypts: "ãƒã‚¤ PTS", ptsprice: "PTS ä¾¡æ ¼", value: "KRW ä¾¡å€¤", xName: "X ë‹‰ë„¤ì„", xId: "X ID (@ì•„ì´ë””)", addBtn: "è¿½åŠ ", guide: "<strong>ğŸ’¡ æ¡ˆå†…:</strong><br>1. <strong>æ¥ç¶š</strong> ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™.<br>2. <strong>åå‰ã‚’ã‚¯ãƒªãƒƒã‚¯</strong> ã™ã‚‹ã¨ X ã«ç§»å‹•ã—ã¾ã™.<br>3. ğŸ”¼/ğŸ”½ ã§ <strong>ä¸€ã¤ãšã¤</strong> èª¿æ•´ã—ã¾ã™." },
            vi: { title: "KÃ­ch hoáº¡t trao Ä‘á»•i toÃ n cáº§u River", connect: "Káº¿t ná»‘i", logBtn: "Gá»­i", logPlace: "Sá»‘ lÆ°á»£ng hÃ´m nay", mypts: "PTS Cá»¦A TÃ”I", ptsprice: "GIÃ PTS", value: "GIÃ TRá»Š KRW", xName: "Biá»‡t danh X", xId: "ID X (@username)", addBtn: "ThÃªm", guide: "<strong>ğŸ’¡ HD:</strong><br>1. Nháº­p máº­t kháº©u khi <strong>Káº¿t ná»‘i</strong>.<br>2. <strong>Nháº¥n tÃªn</strong> Ä‘á»ƒ truy cáº­p X.<br>3. DÃ¹ng ğŸ”¼/ğŸ”½ Ä‘á»ƒ chá»‰nh <strong>tá»«ng bÆ°á»›c</strong>." }
        };

        // ğŸ“Š ì‹¤ì‹œê°„ PTS ì‹œì„¸ & ë¹—ì¸ í™˜ìœ¨ ì—°ë™
        async function updateMarketData() {
            try {
                // 1. ë¹—ì¸ USDT/KRW í™˜ìœ¨
                const bRes = await fetch('https://api.bithumb.com/public/ticker/USDT_KRW');
                const bData = await bRes.json();
                if(bData.status === "0000") {
                    usdtKrwRate = parseFloat(bData.data.closing_price);
                    document.getElementById('currentUsdtRate').innerText = `1 USDT = â‚© ${usdtKrwRate.toLocaleString()}`;
                }

                // 2. River Pts (0xfc6...014) ì‹¤ì‹œê°„ ê°€ê²©
                const tokenAddr = "0xfc6be825925b7a83d131e33b46efef9084f0e014";
                const pRes = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${tokenAddr}`);
                const pData = await pRes.json();
                if(pData.pairs && pData.pairs.length > 0) {
                    livePtsPrice = parseFloat(pData.pairs[0].priceUsd);
                    document.getElementById('ptsPriceDisplay').innerText = `$ ${livePtsPrice.toFixed(6)}`;
                }
                runCalculation();
            } catch(e) { console.error("Data error:", e); }
        }

        function runCalculation() {
            const qty = parseFloat(document.getElementById('calcQty').value) || 0;
            const total = qty * livePtsPrice * usdtKrwRate;
            document.getElementById('resKrw').innerText = `â‚© ${Math.floor(total).toLocaleString()}`;
        }

        function saveAndConnect() { 
            const mId = document.getElementById('managerId').value;
            if(!mId) return alert("ID!");
            const code = prompt("PW:");
            if (code === PRIVATE_CODE) { localStorage.setItem('river_manager_id', mId); fetchUsers(); fetchDailyLogs(); }
            else { alert("X"); }
        }

        async function addNewMember() {
            const mId = document.getElementById('managerId').value;
            const name = document.getElementById('newMemberName').value;
            const xIdInput = document.getElementById('newMemberXId').value;
            if(!mId || !name) return alert("Check!");
            const { data } = await supabaseClient.from('river_members').select('priority').eq('manager_id', mId).eq('country', currentCountry).order('priority', { ascending: false }).limit(1);
            const nextPriority = (data && data.length > 0) ? data[0].priority + 1 : 1;
            const cleanXId = xIdInput.startsWith('@') ? xIdInput.substring(1) : xIdInput;
            const { error } = await supabaseClient.from('river_members').insert([{ manager_id: mId, name: name, x_id: cleanXId, country: currentCountry, priority: nextPriority }]);
            if(!error) { document.getElementById('newMemberName').value = ''; document.getElementById('newMemberXId').value = ''; fetchUsers(); }
        }

        async function moveMember(globalIndex, direction) {
            const targetIndex = globalIndex + direction;
            if (targetIndex < 0 || targetIndex >= allUsers.length) return;
            const current = allUsers[globalIndex], target = allUsers[targetIndex];
            await supabaseClient.from('river_members').update({ priority: target.priority }).eq('id', current.id);
            await supabaseClient.from('river_members').update({ priority: current.priority }).eq('id', target.id);
            fetchUsers();
        }

        async function editMember(id, oldName) {
            const newName = prompt("Edit:", oldName);
            if(newName) { await supabaseClient.from('river_members').update({ name: newName }).eq('id', id); fetchUsers(); }
        }
        async function deleteMember(id) {
            if(confirm("Delete?")) { await supabaseClient.from('river_members').delete().eq('id', id); fetchUsers(); }
        }

        async function addDailyLogToDB() {
            const mId = document.getElementById('managerId').value;
            const qty = document.getElementById('dailyPtsInput').value;
            if(!mId || !qty) return;
            await supabaseClient.from('river_daily_logs').insert([{ manager_id: mId, amount: parseInt(qty) }]);
            document.getElementById('dailyPtsInput').value = ''; fetchDailyLogs();
        }
        async function editLog(id, oldVal) {
            const newVal = prompt("Edit:", oldVal);
            if(newVal !== null && newVal !== "") { await supabaseClient.from('river_daily_logs').update({ amount: parseInt(newVal) }).eq('id', id); fetchDailyLogs(); }
        }
        async function deleteLog(id) {
            if(confirm("Delete?")) { await supabaseClient.from('river_daily_logs').delete().eq('id', id); fetchDailyLogs(); }
        }
        async function fetchDailyLogs() {
            const mId = document.getElementById('managerId').value;
            if(!mId) return;
            const { data } = await supabaseClient.from('river_daily_logs').select('*').eq('manager_id', mId).order('created_at', { ascending: false }).limit(10);
            const list = document.getElementById('dailyLogList');
            list.innerHTML = (data || []).map(l => {
                const d = new Date(l.created_at);
                return `<div class="log-row"><div>ğŸ—“ï¸ ${d.getMonth()+1}/${d.getDate()} <span class="font-bold text-indigo-400 ml-2">${l.amount.toLocaleString()} Pts</span></div><div class="flex gap-4"><span onclick="editLog(${l.id}, ${l.amount})" class="btn-icon">âœï¸</span><span onclick="deleteLog(${l.id})" class="btn-icon">âŒ</span></div></div>`;
            }).join('');
        }

        async function fetchUsers() {
            const mId = document.getElementById('managerId').value;
            if(!mId) return;
            const { data } = await supabaseClient.from('river_members').select('*').eq('manager_id', mId).eq('country', currentCountry).order('priority', { ascending: false });
            allUsers = data || []; renderTable();
        }

        function renderTable() {
            const body = document.getElementById('userTableBody'); body.innerHTML = '';
            const start = (currentPage - 1) * itemsPerPage;
            const pageData = allUsers.slice(start, start + itemsPerPage);
            pageData.forEach((u, i) => {
                const globalIdx = start + i;
                const twitterLink = u.x_id ? `<span class="member-link" onclick="window.open('https://x.com/${u.x_id}', '_blank')">${u.name}</span>` : `<span>${u.name}</span>`;
                body.innerHTML += `<tr><td class="p-4 flex justify-between items-center"><div><span class="text-indigo-400 font-black mr-2">#${globalIdx + 1}</span><strong>${twitterLink}</strong></div><div class="flex gap-4 text-xl"><span onclick="moveMember(${globalIdx}, -1)" class="btn-icon text-blue-400">ğŸ”¼</span><span onclick="moveMember(${globalIdx}, 1)" class="btn-icon text-blue-400">ğŸ”½</span><span onclick="editMember(${u.id}, '${u.name}')" class="btn-icon text-orange-400 text-sm">âœï¸</span><span onclick="deleteMember(${u.id})" class="btn-icon text-red-500 text-sm">âŒ</span></div></td></tr>`;
            });
            renderPagination();
        }

        function renderPagination() {
            const div = document.getElementById('pagination'); div.innerHTML = '';
            const totalPages = Math.ceil(allUsers.length / itemsPerPage);
            if (totalPages <= 1) return;
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.innerText = i; btn.className = `page-btn ${currentPage === i ? 'active' : ''} mx-1`;
                btn.onclick = () => { currentPage = i; renderTable(); }; div.appendChild(btn);
            }
        }

        function changeLanguage(lang) {
            currentLang = lang; const t = translations[lang] || translations.ko;
            document.getElementById('main-title').innerText = t.title;
            document.getElementById('btnConnect').innerText = t.connect;
            document.getElementById('btnLogAdd').innerText = t.logBtn;
            document.getElementById('dailyPtsInput').placeholder = t.logPlace;
            document.getElementById('lbl-mypts').innerText = t.mypts;
            document.getElementById('lbl-ptsprice').innerText = t.ptsprice;
            document.getElementById('lbl-value').innerText = t.value;
            document.getElementById('guideContent').innerHTML = t.guide;
            document.getElementById('newMemberName').placeholder = t.xName;
            document.getElementById('newMemberXId').placeholder = t.xId;
            document.getElementById('btnAddMember').innerText = t.addBtn;
            fetchDailyLogs();
        }

        function switchCountry(code) { 
            currentCountry = code; currentPage = 1;
            document.querySelectorAll('[onclick^="switchCountry"]').forEach(b => b.classList.remove('tab-active'));
            document.getElementById(`tab-${code}`).classList.add('tab-active');
            fetchUsers(); 
        }

        window.onload = () => {
            updateMarketData(); setInterval(updateMarketData, 60000);
            const savedId = localStorage.getItem('river_manager_id');
            if(savedId) document.getElementById('managerId').value = savedId;
            changeLanguage(currentLang);
            if(savedId) { fetchUsers(); fetchDailyLogs(); }
            switchCountry('KR');
            setInterval(() => {
                const html = Object.keys(timeZones).map(code => {
                    const time = new Date().toLocaleTimeString('en-US', { timeZone: timeZones[code], hour: '2-digit', minute: '2-digit', hour12: false });
                    return `<div class="clock-item"><span class="clock-label">${code}</span><span class="clock-time">${time}</span></div>`;
                }).join('');
                document.getElementById('clockDisplay').innerHTML = html;
            }, 1000);
        };
    </script>
</body>
</html>
